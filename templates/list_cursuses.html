{% extends 'base.html' %}

{% block title %}Liste des cursus - Knowledge Learning{% endblock %}

{% block content %}
    <h2>Liste des cursus disponibles</h2>
    {% if cursuses_data %}
        <ul class="list-group">
            {% for data in cursuses_data %}
                {% with cursus=data.cursus %}
                    <li class="list-group-item">
                        <h4>{{ cursus.name }} (Thème : {{ cursus.theme.name }}) -
                            {% if data.has_purchased_cursus %}
                                Déjà payé
                            {% else %}
                                {{ data.adjusted_price }} €
                            {% endif %}
                        </h4>
                        {% if not data.has_purchased_cursus %}
                            <a href="{% url 'buy_cursus' cursus.id %}" class="btn btn-primary btn-sm">Acheter le cursus</a>
                        {% endif %}
                        <h5>Leçons :</h5>
                        <ul>
                            {% for lesson in cursus.lesson_set.all %}
                                <li>
                                    {{ lesson.title }} - {{ lesson.price }} €
                                    {% if lesson.id in data.purchased_lessons or data.has_purchased_cursus %}
                                        <span class="badge badge-success">Déjà payé</span>
                                        <a href="{% url 'view_lesson' lesson.id %}" class="btn btn-info btn-sm">Voir la leçon</a>
                                    {% else %}
                                        <a href="{% url 'buy_lesson' lesson.id %}" class="btn btn-secondary btn-sm">Acheter cette leçon</a>
                                        <a href="{% url 'view_lesson' lesson.id %}" class="btn btn-info btn-sm">Voir la leçon</a>
                                    {% endif %}
                                </li>
                            {% endfor %}
                        </ul>
                    </li>
                {% endwith %}
            {% endfor %}
        </ul>
    {% else %}
        <p>Aucun cursus disponible pour le moment.</p>
    {% endif %}
    <a href="{% url 'home' %}" class="btn btn-primary mt-3">Retour à l'accueil</a>
{% endblock %}